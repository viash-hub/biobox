name: bases2fastq
description: |
  Bases2Fastq demultiplexes sequencing data generated by Element Biosciences instruments and converts base calls into FASTQ files.
keywords: ["demultiplex", "fastq", "demux", "Element Biosciences"]
links:
  documentation: https://docs.elembio.io/docs/bases2fastq/introduction/
license: Proprietairy
requirements:
  commands: [bases2fastq]
authors:
  - __merge__: /src/_authors/dries_schaumont.yaml
    roles: [ author, maintainer ]

argument_groups:
  - name: Input
    arguments:
      - name: "--analysis_directory"
        type: file
        description: Location of analysis directory
        required: true
        example: "input/"
      - name: --run_manifest
        alternatives: [-r]
        type: file
        description: Location of run manifest to use instead of default RunManifest.csv found in analysis directory
        required: false

  - name: Output
    arguments:
      - name: "--output_directory"
        alternatives: ["-o"]
        type: file
        direction: output
        required: true
        description: Location to save output fastqs
        example: fastq_dir
      - name: "--report"
        type: file
        required: false
        direction: output
        description: Output location for the HTML report
      - name: "--logs"
        type: file
        direction: output
        required: false
        description: Directory containing log files
        example: logs_dir
  - name: Arguments
    arguments:
      - name: --chemistry_version
        type: string
        required: false
        description: Run parameters override, chemistry version.
      - name: "--demux_only"
        alternatives: [-d]
        type: boolean_true
        description: |
          Generate demux files and indexing stats without generating FASTQ
      - name: "--detect_adapters"
        type: boolean_true
        description: |
          Detect adapters sequences, overriding any sequences present in run manifest.
      - name: "--error_on_missing"
        type: boolean_true
        description: |
          Terminate execution for a missing file (by default, missing files are
          skipped and execution continues). Also set by --strict.
      - name: "--exclude_tile"
        alternatives: [-e]
        multiple: true
        type: string
        description: |
          Regex matching tile names to exclude. This flag can be specified multiple times. (e.g. L1.*C0[23]S.)
      - name: "--filter_mask"
        type: string
        description: |
          Run parameters override, custom pass filter mask.
      - name: "--flowcell_id"
        type: string
        description: |
          Run parameters override, flowcell ID.
      - name: "--force_index_orientation"
        type: boolean_true
        description: |
          Do not attempt to find orientation for I1/I2 reads (reverse complement).
          Use orientation given in run manifest.
      - name: "--group_fastq"
        type: boolean_true
        description: |
           Group all FASTQ/stats/metrics for a project are in the project folder.
      - name: "--i1_cycles"
        type: integer
        min: 1
        description: |
          Run parameters override, I1 cycles.
      - name: "--i2_cycles"
        type: integer
        min: 1
        description: |
          Run parameters override, I2 cycles
      - name: "--include_tile"
        alternatives: [-i]
        type: string
        multiple: true
        description: |
          Regex matching tile names to include. This flag
          can be specified multiple times. (e.g. L1.*C0[23]S.)
      - name: "--kit_configuration"
        type: string
        description: |
          Run parameters override, kit configuration.
      - name: "--legacy_fastq"
        type: boolean_true
        description: |
          Legacy naming for FASTQ files (e.g. SampleName_S1_L001_R1_001.fastq.gz)
      - name: "--log_level"
        type: string
        alternatives: [-l]
        choices: ["DEBUG", "INFO", "WARNING", "ERROR"]
        description: |
          Severity level for logging.
        example: INFO
      - name: "--no_error_on_invalid"
        type: boolean_true
        description: |
          Skip invalid files and continue execution. Overridden by --strict options
      - name:  "--no_projects"
        type: boolean_true
        description: |
          Disable project directories
      - name: "--num_unassigned"
        type: integer
        min: 0
        max: 1000
        example: 30
        description: |
          Max Number of unassigned sequences to report.
      - name: "--preparation_workflow"
        type: string
        description: |
          Run parameters override, preparation workflow. 
      - name: --qc_only
        type: boolean_true
        description: |
          Quickly generate run stats for single tile without generating FASTQ.
          Use --include_tile/--exclude_tile to define custom tile set.
      - name: --r1_cycles
        type: integer
        min: 1
        description: |
          Run parameters override, R1 cycles.
      - name: --r2_cycles
        type: integer
        min: 1
        description: |
          Run parameters override, R2 cycles.
      - name: "--split_lanes"
        type: boolean_true
        description: |
          Split FASTQ files by lane.
      - name: --strict
        type: boolean_true
        description: |
          In strict mode any invalid or missing input file will terminate execution 
          (overrides no_error_on_invalid and sets --error_on_missing)
  
        # --help, -h                      Display this usage statement              
        # --input-remote, NAME            Rclone remote name for remote ANALYSIS_DIRECTORY
        # --num-threads, -p NUMBER        Number of threads (default 1)
        # --output-remote, NAME           Rclone remote name for remote OUTPUT_DIRECTORY
        # --settings SELECTION            Run manifest settings override. This option may be specified multiple times.
        # --version, -v                   Display bases2fastq version
        # --skip-qc-report SELECTION      Do not generate HTML QC report.

resources:
  - type: bash_script
    path: script.sh

test_resources:
  - type: bash_script
    path: test.sh

engines:
- type: docker
  image: elembio/bases2fastq:2.1.0
  setup:
    - type: apt
      packages:
        - procps
        - tree
    - type: docker
      run: |
        echo "bases2fastq: $(bases2fastq --version | cut -d' ' -f3)" > /var/software_versions.txt
  test_setup:
    - type: apt
      packages: curl

runners:
  - type: executable
  - type: nextflow
